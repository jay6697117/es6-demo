<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Promise.all</title>
  </head>
  <body>
    <script>
      // console.log('-------------------------------------------');
      // Promise.all([
      //   new Promise(resolve => setTimeout(() => resolve(1), 1000))
      //     .finally(() => console.log('Promise1执行'))
      //     .then(res1 => {
      //       console.log('res1 :>> ', res1);
      //       return new Promise((resolve, reject) => {
      //         // return reject(new Error('what the fuck'));
      //         return resolve(res1);
      //       });
      //     }), // 1
      //   new Promise(resolve => setTimeout(() => resolve(2), 1000))
      //     .finally(() => console.log('Promise2执行'))
      //     .then(res2 => {
      //       console.log('res2 :>> ', res2);
      //       return new Promise((resolve, reject) => {
      //         // return reject(new Error('what the fuck'));
      //         return resolve(res2);
      //       });
      //     }), // 2
      //   new Promise(resolve => setTimeout(() => resolve(3), 1000))
      //     .finally(() => console.log('Promise3执行'))
      //     .then(res3 => {
      //       console.log('res3 :>> ', res3);
      //       return new Promise((resolve, reject) => {
      //         // return reject(new Error('what the fuck'));
      //         return resolve(res3);
      //       });
      //     }) // 3
      // ])
      //   .then(result => console.log('result :>> ', result))
      //   .catch(err => console.log('err :>> ', err)); // 1,2,3 当上面这些 promise 准备好时：每个 promise 都贡献了数组中的一个元素

      console.log('-------------------------------------------');

      let urls = [
        'https://api.github.com/users/iliakan',
        'https://api.github.com/users/remy',
        'https://api.github.com/users/jeresig'
      ];

      // 将每个 url 映射（map）到 fetch 的 promise 中
      let requests = urls.map(url => {
        return fetch(url);
      });
      console.log('requests :>> ', requests);
      // Promise.all 等待所有任务都 resolved
      Promise.all(requests)
        .then(responses1 => {
          console.log('responses1 :>> ', responses1);
          return responses1;
        })
        .then(responses2 => {
          console.log('responses2 :>> ', responses2);
          const promiseArr = responses2.map(item => {
            return item.json();
          });
          console.log('promiseArr :>> ', promiseArr);
          return Promise.all(promiseArr);
        })
        .then(result => {
          console.log('result :>> ', result);
        });

      // console.log('-------------------------------------------');

      // let names = ['iliakan', 'remy', 'jeresig'];

      // let requests = names.map(name => fetch(`https://api.github.com/users/${name}`));

      // Promise.all(requests)
      //   .then(responses => {
      //     // 所有响应都被成功 resolved
      //     for (let response of responses) {
      //       alert(`${response.url}: ${response.status}`); // 对应每个 url 都显示 200
      //     }

      //     return responses;
      //   })
      //   // 将响应数组映射（map）到 response.json() 数组中以读取它们的内容
      //   .then(responses => Promise.all(responses.map(r => r.json())))
      //   // 所有 JSON 结果都被解析："users" 是它们的数组
      //   .then(users => users.forEach(user => alert(user.name)));
    </script>
  </body>
</html>
